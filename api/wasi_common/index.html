<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The `WasiFile` and `WasiDir` traits"><meta name="keywords" content="rust, rustlang, rust-lang, wasi_common"><title>wasi_common - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-918aaffdca2f1bdb.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../static.files/ayu-94f39d4346842c1e.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-a211dbb005fb8161.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../wasi_common/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../wasi_common/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate wasi_common</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 6.0.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">wasi_common</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/wasi_common/lib.rs.html#1-73">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h3 id="the-wasifile-and-wasidir-traits"><a href="#the-wasifile-and-wasidir-traits">The <code>WasiFile</code> and <code>WasiDir</code> traits</a></h3>
<p>The WASI specification only defines one <code>handle</code> type, <code>fd</code>, on which all
operations on both files and directories (aka dirfds) are defined. We
believe this is a design mistake, and are architecting wasi-common to make
this straightforward to correct in future snapshots of WASI.  Wasi-common
internally treats files and directories as two distinct resource types in
the table - <code>Box&lt;dyn WasiFile&gt;</code> and <code>Box&lt;dyn WasiDir&gt;</code>. The snapshot 0 and
1 interfaces via <code>fd</code> will attempt to downcast a table element to one or
both of these interfaces depending on what is appropriate - e.g.
<code>fd_close</code> operates on both files and directories, <code>fd_read</code> only operates
on files, and <code>fd_readdir</code> only operates on directories.
The <code>WasiFile</code> and <code>WasiDir</code> traits are defined by <code>wasi-common</code> in terms
of types defined directly in the crate’s source code (I decided it should
NOT those generated by the <code>wiggle</code> proc macros, see snapshot architecture
below), as well as the <code>cap_std::time</code> family of types.  And, importantly,
<code>wasi-common</code> itself provides no implementation of <code>WasiDir</code>, and only two
trivial implementations of <code>WasiFile</code> on the <code>crate::pipe::{ReadPipe, WritePipe}</code> types, which in turn just delegate to <code>std::io::{Read, Write}</code>. In order for <code>wasi-common</code> to access the local filesystem at all,
you need to provide <code>WasiFile</code> and <code>WasiDir</code> impls through either the new
<code>wasi-cap-std-sync</code> crate found at <code>crates/wasi-common/cap-std-sync</code> - see
the section on that crate below - or by providing your own implementation
from elsewhere.</p>
<p>This design makes it possible for <code>wasi-common</code> embedders to statically
reason about access to the local filesystem by examining what impls are
linked into an application. We found that this separation of concerns also
makes it pretty enjoyable to write alternative implementations, e.g. a
virtual filesystem (which will land in a future PR).</p>
<h3 id="traits-for-the-rest-of-wasis-features"><a href="#traits-for-the-rest-of-wasis-features">Traits for the rest of WASI’s features</a></h3>
<p>Other aspects of a WASI implementation are not yet considered resources
and accessed by <code>handle</code>. We plan to correct this design deficiency in
WASI in the future, but for now we have designed the following traits to
provide embedders with the same sort of implementation flexibility they
get with WasiFile/WasiDir:</p>
<ul>
<li>Timekeeping: <code>WasiSystemClock</code> and <code>WasiMonotonicClock</code> provide the two
interfaces for a clock. <code>WasiSystemClock</code> represents time as a
<code>cap_std::time::SystemTime</code>, and <code>WasiMonotonicClock</code> represents time as
<code>cap_std::time::Instant</code>.  * Randomness: we re-use the <code>cap_rand::RngCore</code>
trait to represent a randomness source. A trivial <code>Deterministic</code> impl is
provided.  * Scheduling: The <code>WasiSched</code> trait abstracts over the
<code>sched_yield</code> and <code>poll_oneoff</code> functions.</li>
</ul>
<p>Users can provide implementations of each of these interfaces to the
<code>WasiCtx::builder(...)</code> function. The
<code>wasi_cap_std_sync::WasiCtxBuilder::new()</code> function uses this public
interface to plug in its own implementations of each of these resources.</p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2><div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.SystemTimeSpec"><code>pub use clocks::<a class="enum" href="clocks/enum.SystemTimeSpec.html" title="enum wasi_common::clocks::SystemTimeSpec">SystemTimeSpec</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiClocks"><code>pub use clocks::<a class="struct" href="clocks/struct.WasiClocks.html" title="struct wasi_common::clocks::WasiClocks">WasiClocks</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiMonotonicClock"><code>pub use clocks::<a class="trait" href="clocks/trait.WasiMonotonicClock.html" title="trait wasi_common::clocks::WasiMonotonicClock">WasiMonotonicClock</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiSystemClock"><code>pub use clocks::<a class="trait" href="clocks/trait.WasiSystemClock.html" title="trait wasi_common::clocks::WasiSystemClock">WasiSystemClock</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiDir"><code>pub use dir::<a class="trait" href="dir/trait.WasiDir.html" title="trait wasi_common::dir::WasiDir">WasiDir</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.Error"><code>pub use error::<a class="struct" href="snapshots/preview_1/types/struct.Error.html" title="struct wasi_common::snapshots::preview_1::types::Error">Error</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.ErrorExt"><code>pub use error::<a class="trait" href="snapshots/preview_1/error/trait.ErrorExt.html" title="trait wasi_common::snapshots::preview_1::error::ErrorExt">ErrorExt</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiFile"><code>pub use file::<a class="trait" href="file/trait.WasiFile.html" title="trait wasi_common::file::WasiFile">WasiFile</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.Poll"><code>pub use sched::<a class="struct" href="sched/struct.Poll.html" title="struct wasi_common::sched::Poll">Poll</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.WasiSched"><code>pub use sched::<a class="trait" href="sched/trait.WasiSched.html" title="trait wasi_common::sched::WasiSched">WasiSched</a>;</code></div></div><div class="item-row"><div class="item-left import-item" id="reexport.Table"><code>pub use table::<a class="struct" href="table/struct.Table.html" title="struct wasi_common::table::Table">Table</a>;</code></div></div></div><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="clocks/index.html" title="wasi_common::clocks mod">clocks</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="dir/index.html" title="wasi_common::dir mod">dir</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="file/index.html" title="wasi_common::file mod">file</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="pipe/index.html" title="wasi_common::pipe mod">pipe</a></div><div class="item-right docblock-short">Virtual pipes.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="random/index.html" title="wasi_common::random mod">random</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="sched/index.html" title="wasi_common::sched mod">sched</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="snapshots/index.html" title="wasi_common::snapshots mod">snapshots</a></div><div class="item-right docblock-short">One goal of <code>wasi-common</code> is for multiple WASI snapshots to provide an
interface to the same underlying <code>crate::WasiCtx</code>. This provides us a path
to evolve WASI by allowing the same WASI Command to import functions from
different snapshots - e.g. the user could use Rust’s <code>std</code> which imports
snapshot 1, but also depend directly on the <code>wasi</code> crate which imports
some future snapshot 2. Right now, this amounts to supporting snapshot 1
and “snapshot 0” aka wasi_unstable at once.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="table/index.html" title="wasi_common::table mod">table</a></div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.I32Exit.html" title="wasi_common::I32Exit struct">I32Exit</a></div><div class="item-right docblock-short">An error returned from the <code>proc_exit</code> host syscall.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.WasiCtx.html" title="wasi_common::WasiCtx struct">WasiCtx</a></div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.StringArrayError.html" title="wasi_common::StringArrayError enum">StringArrayError</a></div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.RngCore.html" title="wasi_common::RngCore trait">RngCore</a></div><div class="item-right docblock-short">The core of a random number generator.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="wasi_common" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.0-nightly (b70baa4f9 2022-12-14)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>